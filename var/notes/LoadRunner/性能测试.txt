微信：lujy5309
电话：13811810086
Email：lujy@tedu.cn <mailto:lujy@tedu.cn>
           Lujianyu001@163.com <mailto:Lujianyu001@163.com>
SQL语句
如何积累项目经验：
项目中遇到的问题，是什么原因引起的问题，是如何解决的问题

性能测试：LoadRunner
一、初步概念：
1、功能测试：
  测试产品的功能是否满足功能需求
如：ATM取款（在线取款）是否成功或转账操作是否成功   一个用户

2、性能测试：
  测试产品的性能是否满足性能需求
*包括：时间、多用户共同使用
如：ATM取款（在线取款）耗时30分钟
十万人同时转账，系统崩溃了，都属于性能问题
*结论：性能测试基于功能测试 ，性能的要求高于功能
测试基本流程：功能测试、安全测试、性能测试
招聘的需求：
A、功能测试（手工、自动化）用例设计、脚本编写
B、性能测试（只能自动化）脚本调试、知识面广
硬件、操作系统、网络、服务器软件、数据库、架构…
C、手机测试（手工、自动化）

二、性能测试课程安排
1、性能测试基本概念1-2天
掌握学习方法：3w1h 学好一门技术
what?是什么？核心概念 言简意赅
数组：用来保存一组相同类型数据的载体、容器、数据结构
why？为什么？优势
where？在哪用？应用场合
how？如何使用？使用步骤、注意事项

哪些行业、软件需要进行性能测试？
    1）对性能要求较高的：通讯、银行、金融、证券、保险、互联网应用（电商、社交软件、搜索引擎…）
    2）对性能要求较低的：单击版、少量用户使用的应用

2、性能测试工具：HP LoadRunner11   60%使用率
   其他工具：JMeter 20%左右使用率
  1）LoadRunner的初级部分：三大组件的基本运行
       a、脚本生成器：录制、调试、增强性能测试脚本
       b、控制台：总指挥部
       c、结果分析器：分析性能测试结果数据，得出测试报告
  2）LoadRunner的高级部分：三个组件深入掌握

3、性能测试高级部分：性能测试计划制定、遇到问
题（瓶颈），如何定位、定性、进行性能调优（架
构师）

并行：多任务占据各自的资源一起运行
并发：多任务抢占少量资源看似一起运行
对奥运门票的系统分析：
  压力激->瞬时压力：并发压力（并发测试）
  系统瘫痪->宕机（down机）
甲方：奥组委（需求方）
乙方：开发方
第三方：测试团队
问题原因：预估不足
   客户端-网络-服务器
北京          上海  平均网路延迟0.2秒
上海          上海

三、性能测试的概念
1、性能测试：模拟真实的生产环境，以各种不同的压力（模拟大量用户）去测试被测系统，根据性能需求来关注性能指标，根据测试结果分析系统是否存在性能瓶颈
常见性能指标：平均事务响应时间、TPS每秒的事务数、系统资源：CPU、Memory内存、Disk磁盘、Network网络等资源指标

2、注意：性能测试之前要做好系统备份

3、性能测试首先要看需求，如果没有需求，要多和客户交流、根据被测系统的相关资料，结合测试经验，去编写性能测试计划（设计），作为后续执行测试的重要依据

4、负载测试和压力测试区别?
  1）共同点：都是在测试过程中逐步加压（递增测试）
  2）负载测试：Load Testing
   是在正常范围内测试，满足性能需求、正常运行；
----见好就收
  3）压力测试：Stress Testing
  可以在极端范围内测试，测试系统的性能极值；
----得寸进尺/使劲折腾
  4）举例：性能需求要求系统支持100用户并发
  负载测试：20、40、60、80、100
  压力测试：100、200、300…

5、影响性能的因素：
  1）数据库：60%以上的性能问题和数据库有关
  2）硬件配置：可扩展（可伸缩）
  3）操作系统：Linunx/Unix一般和配置有关
  4）网络协议等…

网络协议Protocol：网络通信的语言、规范、规则
  如：Http 、TCP、UDP、FTP
http协议：超文本传输协议（互联网最重要的协议）
<http://www.tmooc.cn>
特点：简单的、无状态的协议
客户端向服务器发送http request：请求
服务器向客户端返回http response：响应、应答
称为一次交互

6、被测系统：SUT
SUT：System Under Test  系统
AUT：Application Under Test  应用
EUT：Environment Under Test  环境
Web应用典型三层架构：
                               被测系统   SUT
----------------------------------------------------------------------
 Client    ---网络---web server---网络---Db server           
客户端浏览器       web服务器             数据库服务器
                          部署web应用程序      管理表和数据
请求      Request------->      处理     ------>  查询user表 select
响应  response   <------                  <------- 结果

四、LoadRunner的工作原理：录制-回放的工作方式
1、录制时：LoadRunner根据相关网络协议，记录下客户端和服务器二者之间的对话（请求包和应答包）；使用真实的浏览器

2、回放时：LoadRunner模拟真实的客户向服务器发起请求，并按照增强或的脚本去验证服务器的应答（检查点）

补充说明：有时脚本录制不下来，需要自己写脚本，发现测试时通过了，但实际运行时服务器瘫痪了
原因：没有模拟真实的客户端效果，接收也出现问题，导致失败
结论：即便是自己写脚本也要模拟真实的客户端效果。

3、LoadRunner三大组件：
  1）虚拟用户脚本生成器：VuGen 或 VUG
  Virtual User Generator
功能：录制、编辑、调试性能测试脚本

2）压力调度控制台（Controller）
功能：创建场景、运行场景、监控场景，收集测试数据
  （场景：Scenario 就是一个大型的配置文件，通过控制台界面来配置整个测试计划细节，保存为场景文件）

3）压力结果分析器（Analysis） 
功能：把收集到的测试数据以各种图表形式展示；
便于进行性能分析，得出测试结果报告。
各司其职，各尽所能

五、关注SUT，并进行脚本录制和回放
1、熟悉SUT：LR自带的B/S架构的系统WebTours航空订票系统
  先启动web服务器：Xitami小型服务器
  打开浏览器，输入URL地址:统一资源定位

http://127.0.0.1:1080/WebTours/

用户名：jojo
密码：bean

系统功能介绍：
1）Login：用户登录 只有用户登录成功，才称为在线
2）Sign Off： 退出登录
3）Flights：订票
4）Itinerary：查看订票记录
5）Home：主页

2、LR使用之前的注意事项
1）修改浏览器的配置（默认IE）
<1>工具-> Internet选项->常规->设置->每次访问此页时检查
原因：当脚本更新时，能够及时适应

<2>工具-> internet选项->程序->重置Web设置（或设置为默认值IE）
原因：将IE浏览器去作为默认打开的浏览器

<3>工具-> Internet选项-> 高级->去除启用第三方浏览器扩展
原因：避免录制时无法自动打开网页

2）由于当前教学环境，导致LR三大组件运行缓慢如何解决：禁用本地连接
  右键网上邻居-->属性-->本地连接-->停用

3）如果WebTours中的Flights功能无法使用：
原因：和Oracle中的Perl资源冲突
如何解决:删除以下两个目录 前提：关闭perl.exe进程
D:\oracle\product\10.1.0\db_1\perl\5.6.1\bin
MSWin32-x86
D:\oracle\product\10.1.0\db_1\perl\5.6.1\lib
MSWin32-x86

4）要求打开loadRunner任何一个组件，都从开始->所有程序打开，不能用快捷方式

5）当录制时，如果被测系统网页无法自动打开，因为系统某些服务产生影响，比如java.exe，建议关闭所有无关的、有影响的服务

3、案例：录制并回放用户登录脚本
使用：VuGen
开始-->所有程序-->HP LoadRunner-->Application-->Virtual Vuser Generator
点击New 新建脚本-->选择录制的协议：
默认：Web[HTTP/HTML]
-->Create 创建
填写基本信息：
1）软件架构类型：Internet Application（B/S）默认Win32 Application（C/S）
2）选择浏览器类型：默认IE
3）URL Address：被测系统的网址
  <http://127.0.0.1:1080/WebTours/>
或
  <http://localhost:1080/WebTours/>
4）Working Directory：LR工作路径 默认 常用工具
5）Record into Action：录制脚本的位置 默认Action
（vuser_into 初始化   Action 核心动作 vuser_end 结束）
-->OK 自动打开浏览器SUT首页，开始录制  关注小操作条（录制控制，关注数字的变化Event记录事件步骤，等待数字稳定后才能继续操作）-->输入jojo和bean -->开始事务（插入事务）名称：login--> OK -->点击login -->OK -->结束事务login -->OK -->切换到vuser_end模式，点击Sign Off退出--

关闭浏览器-->点击stop结束录制
修改字体Tools-->General Option -->Environment--> Editor Comic Sans MS 14 Blold
建议新建工作目录：D:\work（目录名使用英文、数字）新建三个子目录：
1）script   存放脚本文件 *.usr
2）scenario 存放场景文件 *.lrs
3）result   存放结果分析文件 *.lra
脚本保存在：D:\work\script\Day01\login
关注脚本的基本组成和执行流程：
类c语法=c语言语法+LoadRunner环境语法
1）vuser_init.c   初始化脚本  仅执行一次
2）Action.c      核心脚本   默认执行一次可以循环n次
3）vuser_end.c   结束脚本   仅执行1次
4）globals.h      头文件（包含LR函数的声明）

4、录制脚本注意事项
1）在录制之前，建议要手工执行一遍测试点，比如登录、购票...
好处：a.熟悉录制的业务流程；
	b.保证业务功能正常使用
2）录制时，创建脚本从New开始，不能补录。

3）录制时，如何选择Action？
一般将登录操作录制到vuser_init中；仅执行1次将关心的操作（订票、查询线路）录制到Action；可n次，将退出系统操作录制到vuser_end中，仅执行1次
原因：Action比较强大，具备其他部分没有的功能：
  比如：参与迭代、设置并发…
说明：login脚本的核心业务就是登陆，所以录制到Action中

5、脚本细节分析
1）每个脚本中都有类似函数function/method方法
函数有三要素：函数名（参数表，…）
vuser_init(){     //默认返回类型int 可以省略
return 0;      //返回0表示正常结束，-1错误退出
}

2）向服务器发送一个请求的函数
web_url("WebTours",    //步骤名
"URL=http://localhost:1080/WebTours/",   //请求地址
"Resource=0", 
"RecContentType=text/html", 
"Referer=", 
"Snapshot=t1.inf",     //快照名 t1.inf 是唯一的
"Mode=HTML", 
LAST);

3）事务的开始和结束（边界）Transaction 事务
思考：为什么需要添加事务函数？
原因：后续场景运行中自动统计每个事务的响应时间，得出平均事务影响应时间--性能分析的重要指标

lr_start_transaction("joker");    //开始login事务
具体业务流程...一般都是请求..
lr_end_transaction("vuser_end",LR_AUTO);    //结束login事务

4）
web_submit_form("login.pl",    //步骤名
"Snapshot=t2.inf",         //快照名
ITEMDATA,       //分隔符  后续是表单提交的数据
"Name=username", "Value=jojo", ENDITEM, 
"Name=password", "Value=bean", ENDITEM, 
"Name=login.x", "Value=63", ENDITEM, 
"Name=login.y", "Value=6", ENDITEM, 
LAST);

5）等待时间  单位：秒   步骤间的等待时间
lr_think_time(104);   	  //类似于wait();  

6、脚本录制后，调试完成：
1）保存：save
2）编译：Compile  保证脚本语法基本正确；
		此时Vugen也会自动保存脚本
3）运行（回放）Run

设置运行后自动出现测试结果：
Tools ->General Options -> Replay 回放 -> After Repaly 选项 Virtual test result 虚拟测试结果

复习：
1、性能测试：根据需求（功能->业务，性能->指标）
指定性能测试计划，模拟真实的生产环境，根据不同的测试策略，使用不同的压力（虚拟用户）对被测系统发起访问，根据测试结果进行性能分析
2、LoadRunner的三大组件
1）VuGen：虚拟用户脚本生成器
功能：录制、编辑、增强脚本，模拟1VU回放脚本
2）Controller：压力调度控制台
功能：设置、运行和监控场景Scenario，获取测试结果数据
3）Analysis：压力结果分析器
功能：将测试结果的数据以不同的图表呈现，性能分析
3、LoadRunner的工作原理
1）录制时：LR根据相关协议（web[HTTP/HTML]）记录下客户端和服务器二者之间的对话（请求包-->日志，脚本、应答包-->日志）
web_url  web_submit_from …
2）回放时：LR模拟真实的客户端向服务器发起请求，并且按照增强后的脚本去验证服务器的应答（检查点）
4、什么是事务？为何要插入事务？哪里添加事务？
1）事务：Transaction那段业务流程需要统计时间，就可以认为是一个事务
 事务分为事务的开始、结束和之间的业务操作，用于度量服务器重要的性能指标：平均事务响应时间：
 Average Transaction  Response  Time
2）原因：为某段业务操作添加事务，并命名，场景运行后自动统计不同事务的平均响应时间
 事务函数：
lr_start_transaction(“事务名”)
核心脚本
lr_end_transaction(“事务名”，LR_AUTO)
3）哪里添加：关心那段操作的时间，哪里就是事务
补充：业务基本原则----358原则
3s以内，用户可以接受；5s以内，用户可以忍受，超过8s忍无可忍
5、虚拟用户：Virtual User 简称 Vuser    VU
1）LR通过工具模拟一个或多个VU，模拟真实的用户向系统发起访问
2）VuGen只能模拟一个VU
Controller场景中可以设置多个VU
 目的：向服务器提供负载（压力）
3）原理：每一个VU都对应一个进程或线程
  常用线程方式模拟VU，占测试机系统资源少；
一般PC机模拟2000VU（线程）
  进程（Process）和线程（Thread）的区别？
  1）进程是正在执行的程序，比较消耗系统资源
  2）线程是在进程内部开辟的多任务，比较节约系统资源；轻量级

6、loadRunner使用VuGen录制时，Action的选择只能从前往后，不可中途往回选：
vuser_init  ->  Action  ->  vuser_end

练习：录制并回放购票脚本  day02/buy 
录制流程：New —>选择vuser_init--> ok -->首页面-->输入用户名密码-->开始事务login-->点击login -->结束事务login-->切换Action-->点击Flights（等待页面加载完毕）
-->选择城市从…到…-->Continue-->Continue-->开始事务buy-->点击Continue-->结束事务buy-->切换vuser_end-->点击sign off-->关闭浏览器-->stop
保存在：
D:\work\script\Day02\BUY
编译-->回放	
7、LoadRunner基本测试流程
1）根据需求制定性能测试计划       测试经理 word
2）录制性能测试脚本
3）编辑、调试、运行测试脚本
4）设置场景
5）运行、监控场景，自动收集测试数据
6）生成结果报告，分析性能情况

问题：以上流程用了几个组件，分别在何处？
1）VuGen：       第2 ，3步骤
2）Controller：    第4,5 步骤
3）Analysis：      第6步骤

并行：多个任务（进程/线程）占据各自的资源（CPU）一起运行；
并发：多个任务（进程/线程）抢占少量资源（CPU）看似一起运行；（分时间片轮换）
  Concurrency
在线：Online用户登录成功后，称为在线，系统需要为用户维持一定的系统资源，用户具有相关的一些权限执行某些业务操作
区别：注册用户数、在线用户数、并发用户数
         账户信息          已经登录       严格同时访问
举例： 1000              100               10/2/3

一、性能测试的基本概念
1、并发在线的区别：并发的压力是一种瞬时压力，一般针对同一类型的业务；在线的压力是一段时间内的压力
规律：一般20个用户并发产生的压力相当于200用户在线的压力（大约1:10比例）
指定测试计划时，作为参考，比如最大在线用户数10000人，建议最多测试测试1000~2000用户的并发
2、请求响应时间=客户端时间+网络时间+服务器时间
               被测系统SUT
---------------------------------------------------------------------
Client-网络-web server-网络-DB Server
客户端        web服务器       数据库服务器 
request---------->处理 ------------------>查询
response?------      ?-----------
常用方法：排除法
Internet：互联网/广域网
Intranet：内联网/局域网
建议1：可以通过内网测试规避网络的问题，客户端一般不会成为性能瓶颈（有问题一般和JavaScript程序有关-前端技术，比如客户端验证等）所以在大部分情况下，如果请求响应时间长，性能瓶颈出现在服务器端
建议2：web服务器和数据库服务器最好分开部署，既可以让压力更加均衡，又可便于LR分别监控，发现性能瓶颈
---分布式
3、事务响应时间：用户完成某个具体操作所需的时间。
Transaction Response Time
比如：下订单、登录、转账、抢红包…都可以是一个事务
一个事务范围内可能包含有多个请求，包含了若干个请求响应时间

4、点击率Hits Per Second越大，对服务器的压力越大
含义：每秒钟用户向web服务器提交的Http请求数
 不是指鼠标点击的次数，比如：点击一个超级链接，服务器返回一个页面，页面中包含了5个图片，则当前发起的点击数：1+5=6个Http请求
比如：<img src=“图片资源路径”/>
自动向服务器发请求，获取图片响应
HTTP：超文本传输协议
HTML：超文本标记语言  网页语言、浏览器解释的语言
   形式：*.html或*.htm 文本文件
   编辑大量页面元素，通过标签标示不同元素
<html>   根标记   头
<head>
 <title> 浏览器标题 </title> 
</head>
<body> 主体  浏览器正文
其他标签…结合文本内容
</body>
</html>  根标记  尾
5、吞吐量：Throughput
含义：用户在任意给定一秒从服务器获得的全部数据量，单位是字节byte，累计时间内的全部数据量
吞吐率：吞吐量/测试时间   单位byte/sec  效率
         每秒字节数
TPS: Transaction  Per Second 每秒是无数
6、请求和应答：都遵循Http协议
Http Request：客户端向服务器发请求
Http Response：服务器向客户端返回应答（应答）
7、系统资源利用率： 一般指系统中CPU中央处理器、Memory内存、Disk磁盘、Network网络等主要资源的使用情况
比如：CPU 忙的时间的百分比 %Processor Time 
  阈值：超过该值发现性能瓶颈  70%~80%
二、案例：理解三大组件的协作关系
需求：测试用户登录在8个用户访问时的性能情况
关注的性能指标：平均事务响应时间、TPS、点击率…
其他：脚本：login
      账号：jojo bean
      VU数：8个
      用户加载方式：每隔两秒加载1个VU
      运行持续时间：所有VU运行直到结束（脚本）
1、使用VuGen录制login脚本
  调试、回放通过备用  D：\work\script\day02\login
2.使用Controller设置场景 Scenario
开始-> 所有程序-> HP LoadRunner->Applications->Controller
默认使用场景类型：手工场景Manusl Scenario
将User the Percentage Mode to …去除打钩
目的：VU数量目前不用百分比形式分配，使用具体人数->Browsee按钮 选择脚本 day02\login->ok
->场景设置界面：
->设置8个VU：run mode选择 Basic Schedule将	Quantity 改为8   VU数量
->设置VU的行为：
1）Initialize：VU初始化，默认运行前初始化
好比：运动员的热身活动
2）Start Vusers：VU的加载方式，何时启动VU
  start all Vuser simultaneously 同时默认同时加载8个VU
 需求：每隔2秒加载1个VU
  双击->改为：1 Vusers every 00:00：02（HH:MM:SS）->ok
关注Schedule Graphics 计划预览图
横坐标：Time 测试时间  纵坐标：Vuser 虚拟用户数
锯齿状：每隔2秒加载1个VU
虚线：运行时间 不确定
3）Duration ：运行持续时间
A、Run until completion 运行直到结束（脚本结束）选择
B、Run for _ days and _ (hh:mm:ss)具体运行多久
C、Run inderfinitily 无限运行，直到手工停止
建议
及时保存场景文件：ctrl+s
D:\work\scenario\day02\login
->从Design视图 切换到 Run视图
设计               运行
说明：目前暂时忽略对系统资源监控Windows Tesources->设置好场景，可以运行
Start Scenario
脚本 4 行       错误               失败       连接     服务器                                          连接被拒绝
Action.c(4): Error -27796: Failed to connect to server "localhost:1080": [10061] Connection refused
失败原因：web服务器没有启动或已经关闭，需要重新启动服务器
3、点击控制台Run视图中，倒数第三个按钮，针对此次结果，打开Analysis 结果分析器
Reports 报告
Summary Report 总体报告
重点分析事务部分
<IMG src="file:///C:\Documents and Settings\Administrator\feiq\RichOle\3264660912.bmp">
事务名最小 平均 最大标准方差90%时间通过
失败
<IMG src="file:///C:\Documents and Settings\Administrator\feiq\RichOle\3791987079.bmp">

1）重点关注平均事务响应时间：0.471s 符合性能需求
2）最大、最小时间作为参考
3）Std.Deviation 标准方差0.077
该值越趋近于0，说明不同的时间值越接近，说明越稳定
4）90%时间：绝大部分在改时间内完成，辅助分析
Http响应状态码：
200 ok 表示服务器成功给返回响应
404客户端错误，表示资源找不到
一般是访问路径URL有问题
500服务器错误，
一般是服务器端程序出现异常
Graphs图表
Running Vusers 正在运行的虚拟用户数
Hits per Second 点击率
Throughput 
吞吐量
Transaction Summary 事务摘要
Average Transaction Response Time 
平均事务响应时间
技巧：合并图比较右键A图-->Merge Graph -->
选B图
练习：将点击率和吞吐量 
合并
规律：趋势相近，点击率是起因，吞吐量是结果，点击率提高了，在正常范围内吞吐量也会
提高，
如果达到性能瓶颈，就难以提高了
如何看到TPS？
添加新的选项-->新的图
右键Graphs-->add new itemàadd new graph-->
十五中-->Transaction per second0.195
将结果文件保存到
D:\work\result\Day02\8VU_login_rl
三、性能测试的策略
重要的：基准测试、并发测试、综合场景测试（前3个项目必备）
递增测试、极限测试（压力测试）
相对次要：疲劳强度测试、内存泄露测试、数据容量
测试
共同点：以不同的策略向被测系统发起压力（负载）

1、基准测试：Benchmark Testing
含义：就是单用户测试，单用户、但测试点、执行n次；
作为后续其他测试的标杆，基本的准绳
说明：还需要使用LR三大组件，VuGen录制脚本、Controller设置场景、Analysis分析结果报告

2、递增测试：不断加压，发现性能的瓶颈，一般通过“拐点分析法”找到出现变化的 位置比如：每隔一定时间（1s，5s，10s）逐步增加VU，逐步加压；
或在不同场景中使用不同VU数表示不同的压力

3、并发测试：Concurrency Testing
含义：多用户并发执行某一事物操作，几乎同一时刻对系统发起访问，形成瞬时压力（严格的并发）
用途：通过严格的并发测试，考察系统在瞬时较大压力的情况下的承受能力
 
4、在线综合场景测试：号称“能够最真实模拟实际生产环境”

三个要素：
1）多用户：在线

2）多任务（业务、脚本）：至少3个

3）在线执行一段时间：1小时左右注意：

4）多用户一起运行，就可能存在并发，但是不需要像并发测试那样设置集合点，
不需要严格的并发2）综合场景测试过程中，所有VU循环执行相应的业务操作
举例：100用户在线综合场景
100VU共同对SUT执行操作，其中50VU查询商品，30VU添加购物车，20VU查询订单，
在线持续运行1小时 
问题：为什么不模拟大量的登录操作？
因为用户一般不会一直在登录，需要模拟真实的用户体验

5、疲劳强度测试：压力更大、时间更长的在线综合场景测试
比如：对SUT进行长时间的压测，一般12h、24h、7*24h银行系统要求稳定、安全…7*24h 不间断运行

目的：检测系统的稳定性，比如长时间运行中是否出现内存泄露、磁盘空间不足、大量错误异常等

6、内存泄露检查：通过正常的测试、如果发现SUT的内存曲线走势不正常时，则关注其他指标，
通过其走势判断是否出现了内存泄露
内存泄露：c/c++/java都可能发生，表示内存不够

7、数据容量测试：大数据量测试
比如：向数据库中添加200GB的数据量再进行测试，
有时甚至是几tb大数据：Big Data 一般T级、P级以上的有效数据量核心：数据建模、数据挖掘

面试题：如何向数据库中插入大量的数据？
思路：SQLinsertinto表名values（值1，...）

自动化：循环反复执行insert 变量、参数化代替固定值
数据库可以写过程化语句，结合sql编程

8、极限测试：也称为压力测试、摸高测试含义：使用并发测试、在线综合场景测试等方法，测试出系统能够承受的极限压力（如最大并发用户数）
或系统能够达到的最大出力能力（如最大吞吐量、TPS），
可以采用递增测试方法，比如对系统进行100VU、200VU…的性能测试

四、基准测试：单用户、但测试点、执行n次/一段时间
1、需求：对购票操作进行基准测试。

2、测试脚本中要加检查点原因：LR报告（Test Results）中验证的只是网络层面，服务器收到客户端的请求包，
并将响应包返回给客户端，但是LR不会验证响应包中的数据是否正确

案例：先录制buy脚本，插入文本检查点。先打开SUT，熟悉购票业务流程；
录制流程：New-->选择vuser_initàok-->
首页面-->输入jojo和bean-->开始事务login-->
点击Login-->选中“Welcome，jojo”-->
插入文本检查点Insert text check按钮 （小望远镜图表）-->
结束事务login--> 切换Action--> 点击Flights（等待页面加载完毕）-->
选择城市从…到…-->Continue-->Continue-->开始事务buy-->点击Continue-->
针对“Denver for London”添加文本检查点-->结束事务buy-->切换vuser_end-->
点击sign off-->关闭浏览器-->stop 保存在：D:\work\script\Day03\BUY
编译-->回放

定义函数的目的：封装一些常用的功能、代码调用函数的目的：重复使用已有的功能（复用）
web_reg_find('Text=Welcome,<b>jojo</b>,', LAST);web_reg_find('Text=Denverfor London', LAST); 

3、检查点函数：web_reg_find(“Text=xxx”,LAST);
xxx就是要检查的文本
规律1：LR脚本中具有两种函数：
1）c语言函数：函数名比较简约strcmp 字符串比较
2）LR函数：一般lr_ 或 web_开头（通用函数） （web协议定制的）
lr_start_transactionlr_think_timeweb_reg_findweb_urlweb_submit_form
规律2：web_reg_find函数
带有reg字样带有reg字样的函数，称为“注册性函数”regist 注册

特殊之处：必须写在相应请求之前相应请求：引起需要检查的响应所对应的请求
相应请求之后，返回响应，响应只能够需要检查文本

规律3：检查的是页面源代码文本Welcome，<b>jojo</b>,

4、只有添加过 检查点的脚本运行正确，才说明脚本基本正确（脚本中需要适当的增强）

    没有找到文本的错误：Action.c(79):
    Error -26366: 'Text=Denverfor London1' not found for
    web_reg_find[MsgId: MERR-26366]
    Action.c(79):
    web_submit_form('reservations.pl_3') highest severity level was
    'ERROR', 3212 body bytes, 572 header bytes[MsgId: MMSG-26388] 

需求：循环订3张票VuGen中Run-time Settings按钮 运行时设置
Run logic 运行逻辑
Iteraction Count：迭代次数
Number ofIteractions：默认1 改为3注意：循环的只是Action部分
vuser_init 和vuser_end部分只执行一次

5、控制台和VuGen中设置Run-time Settings的练习和区别
1）如果从控制台中直接打开脚本，VuGen中设置会带过来2）如果控制台中也进行了设置，并且值不同，控制台的优先级高；
3）建议：统一在控制台中设置
6、Pacing 值：每次迭代的时间间隔。 单位s每次迭代：LR每次执行Action脚本代码
规律：Pacing值越大，对SUT的压力越小

7、Think time ：脚本中每个步骤之间的时间间隔。单位：s
每个步骤：一般都是每个请求

web_url访问URL地址请求web_submit_form提交表单请求
web_link点击超级链接请求用途：可以控制脚本中是否使用think time ，以及如何使用 如果Ingore 忽略，
则脚本中lr_think_time(18);都将失效规律：thinktime值越大，对SUT的压力越小 

8、完成案例：针对buy业务进行基准测试方法1：单用户循环执行n次比如5次

1）调试好脚本（在VuGen编译-->回放通过）

2）打开控制台，加载buy
脚本
设置脚本组：组名、脚本路径、VU数量
Run mode中，单选Basic
Schedule将Quantity改为：1 单用户

3）打开控制台中Run-time Settings：
迭代次数：改为5次

4）Pacing值：迭代的间隔时间
有三种方案：
a、as soon as the previous iteraction ends
只要上一次迭代结束----紧锣密鼓b、在上一次迭代结束后设置为随机2.000~3.000s固定的with
a_fixed_delay of_6.000_sec
随机的
witha_random_delay of_2.000_to_3.000_sec
间隔(intervals)c、at_fixed_intervals,every_6.000_sec_random_every_2.000_to_3.000_sec

5）Think time：思考时间/等待时间
Ignore think time：忽略思考时间（选择）
Replay think time：设置具体策略-->点击ok

6）设置VU的行为：
1）初始化：默认运行前初始化（准备好VU）
2）加载方式：默认同时加载就1VU3）持续时间Duration：默认运行直到结束（脚本结束）
原因：由迭代次数决定，运行5次就结束保存场景文件：D:\work\scenario\day03\buy_基准测试v1-->
切换到run视图 运行场景Start scenario 

归纳基准测试：

方法1：单用户循环执行n次比如5次
1）调试好脚本（加事务、检查点、在VuGen中运行成功）
2）打开控制台，加载相关脚本buy
3）设置VU数量：1个
4）设置VU行为：初始化、加载方式、持续时间
5）Run_time
    Settings：
        a、迭代次数：n次比如5次
	b、Pacing：随机2.000---3.000s迭代之间的间隔时间
	c、think time：可忽略请求之间的间隔时间
	原因：单用户对系统压力较小，忽略对结果无影响
	

方法2：单用户持续运行n时间比如1分钟
1）调试好脚本（加事务、检查点、在VuGen中运行成功）
2）打开控制台，加载相关脚本buy
3）设置VU数量：1个
4）设置VU行为：初始化、加载方式、持续时间Duration：改为持续1分钟
5）Run_time
    Settings：
        a、迭代次数：n次比如5次
	b、Pacing：随机2.000---3.000s迭代之间的间隔时间
	c、think time：可忽略请求之间的间隔时间
	原因：单用户对系统压力较小，忽略对结果无影响

说明：
1）当Run—time Settings中的迭代次数和Durartion冲突时，Duration优先级高Duration
第一项：运行直到结束将运行方式交给迭代次数决定（授权）
用途：明确迭代次数时使用
第二项：Run for_days and_(hh:mm:ss)
持续时间有Duration说的算，
Action迭代的次数取决于实际情况，指的是Action持续迭代的时间，时间将至，
LR会发出指令，通知UV结束运行STOP2）如何统计性能测试数据？
建议对场景运行3次，在测试报告中，取中间值；
比如平均事务响应时间：
第一次          第二次          第三次
0.217          0.318          0.201
取值：0.2173）目前暂时忽略了对系统资源的监控（后续补充）

练习：使用LR三大组件，完成10VU购票的场景
要求：脚本buyvu数：10个VU
行为：默认初始化，每隔1s加载2VU，运行直到结束
其他自行设置
目的：熟悉三大组件协作运行以上就是基准测试

五、并发测试Concurrency Testing

1、含义：模拟多用户几乎同一时刻，集中访问系统的某一功能点，
经过严格的并发，考虑对瞬时较大压力的承受能力。

*2、并发测试的两个条件：
  1）脚本中设置集合点（并发点）
  2）控制台场景中要设置并发策略
    集合点：5个线程，代表5个VU并发执行一次购票
    
-------------------- buy事务的开始 --------------------
o--------------------------lo--------------------->
o--------------------------lo--------------------->
o--------------------------lo--------------------->
o--------------------------lo--------------------->
o--------------------------lo--------------------->
-------------------- 此处设置集合点（并发点） --------------------

要求：Action脚本中，在buy事务开始之前，设置集合点；

等待所有VU到达集合点时，才一起释放，此时形成瞬时压力
并发策略：比如：等待所有的VU到达集合点时一起释放

3、集合点只有在并发测试时才使用，平时不需要形成严格的并发
4、案例：5VU并发购票测试
  思路：buy脚本要添加事务、事务之前添加集合点，
  场景中设置并发策略，默认每个VU迭代1次即可，
  默认都订一张票，

运行场景，获取测试结果

  1）先录制buy脚本，添加事务、检查点
  技巧：脚本的备份Fileàsave as 另存为buy1
  2）集合点：Action中，buy事务开始之前添加集合点
  光标放在事务开始之前lr_start_transaction(“buy”);点击Insert-->Rendezvous集合点
  -->输入集合点名称Rendezvous Name ：buy 同事务名就会生成脚本：lr_rendezvous('buy');

LR函数
集合点函数-->及时保存à编译Compile 最新版本3）打开控制台，设置并发策略
加载buy1 脚本：
注意：如果加载后的脚本修改了，先保存并编译，并在控制台中刷新脚本：
选中控制台中脚本组-->Details 细节-->Tefresh 刷新 下拉菜单
  1）选择Script：刷新脚本（常用）
  2）选中runtime settings：将VuGen设置刷新过来（很少用，因为建议在控制台统一设置）
      选择Scenario 菜单-->rendezvous 设置并发策略--> 点击policy 按钮策略

第一项：release when 100% of all vusers arrive at the rendezvous （选择此项）
当所有VU的100%到达集合点时一起释放
比如10个VU都算10*100%=10
第二项：releasewhen 100% of all running vusers arrive at the rendezvous 当正在运行VU的100%到达集合点时一起释放
比如10个VU只有5个正在运行，5*100%=5
第三项：releasewhen 1 vusers arrive at the rendezvous
当n个VU到达集合点时一起释放补充:timeout between Vusers：30 sec超时时间：到达集合点的VU，如果超过30s其他VU还没到来，就会先行释放

4）其他设置：完成5VU的并发购票
a、控制台中：VU数5个

b、用户行为：
初始化：默认
加载方式：默认同时目前VU较少持续时间：运行直到结束只需迭代1次

c、Run-time Setting：
迭代次数：1次pacing：没有间隔log：默认日志think time：默认忽略，不给喘息时间，压力较大，VU能够尽快到达集合点，
更严-->运行场景-->查看测试结果

归纳：
1、测试策略：
基准测试、并发测试、综合场景测试2、基准测试：单用户，单测试点，循环执行n次/n时间
3、并发测试：多用户、但测试点、瞬时压力
1）Action中需要有具体事务；
2）Action 中事务之前设置集合点：
lr_rendezvous(“集合点名称”)3）设置并发策略：

其他：建议忽略思考时间



复习：
触类旁通思路+逻辑+知识点+项目案例

1、如何进行性能测试？ 先整体，后局部

1）分析需求（功能需求—业务逻辑、性能需求—性能指标）
性能指标：平均事务响应时间、TPS、系统资源特性、吞吐量、点击率…

2）指定性能测试计划—测试经理
常见的策略：基准测试、并发测试、综合场景测试

3）执行计划：使用LR结合三大组件A、VuGen：根据协议录制和调试脚本、1VU运行脚本脚本增强：事务（时间、TPS）、检查点、集合点、参数化、关联…2）Controller：设置、运行和监控场景，获取测试结果数据

A、场景模式：手工场景、不用百分比分配VUB、脚本组：组名、脚本路径、VU数量…
C、VU的行为：初始化、加载方式、持续时间
D、Run-time Setting：运行时设置
E、系统资源监控

3）Analysis：对测试结果以图表的形式展示，便于分析，获取性能测试报告
